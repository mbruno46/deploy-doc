name: 'deploy-sphinx-doc'
description: 'Deploy Python documentation generated with Sphinx'
inputs:
  repository:
    description: 'Repository name with owner'
    default: ${{ github.repository }}
  ref:
    description: >
      The branch, tag or SHA to checkout. When checking out the repository that
      triggered a workflow, this defaults to the reference or SHA for that
      event.  Otherwise, uses the default branch.
  path: 
    description: 'Relative path in the repository with documentation source files'
    required: true
  doc-branch:
    description: 'Target branch for documentation deployment'
    required: true
    default: 'gh-pages'
runs:
  using: "composite"
  steps:
    - name: 'Install Sphinx'
      run: |
        pip install sphinx
      shell: bash
    - name: 'Build Doc'
      run: |
        cd ${{ inputs.repository }}/${{ inputs.path }}
        make html
      shell: bash
    - name: 'Deploy'
      run: |
        cd ${{ inputs.repository }}
        git push origin `git subtree split --prefix ${{ inputs.path }}/build/html ${{ inputs.ref }}`:${{ inputs.doc-branch }} --force
      shell: bash
